(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-3",headers:{authorization:"295298ff-2da3-4248-8148-e158f9c4a5df","Content-Type":"application/json"}};function t(e){e.classList.add("popup_opened"),window.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&n(document.querySelector(".popup_opened"))}var r=document.querySelector(".popup_edit-profile"),c=document.querySelector(".popup_add-card"),a=document.querySelector(".popup_edit-avatar"),u=document.querySelector(".profile__add-button"),i=document.querySelector(".profile__edit-button"),s=document.querySelector(".profile__avatar-edit-button"),l=document.querySelectorAll(".popup"),d=document.querySelector(".elements__cards-list"),m=document.querySelector(".popup_full-image"),p=document.querySelector(".popup__image"),f=document.querySelector(".popup__image-caption"),_=document.querySelector("#card-template").content,v=document.querySelector('form[name="add-card"]'),h=document.querySelector(".popup__submit-button_add-card"),y=document.querySelector(".popup__form-text_title"),b=document.querySelector(".popup__form-text_link"),S=document.querySelector(".popup__form-text_link-avatar"),q=document.querySelector(".popup__form-text_name"),k=document.querySelector(".popup__form-text_subname"),L=document.querySelector('form[name="user-info"]'),E=document.querySelector(".popup__submit-button_edit-profile"),C=document.querySelector(".popup__submit-button_edit-avatar"),g=document.querySelector('form[name="user-avatar"]'),x=document.querySelector(".profile__name"),j=document.querySelector(".profile__subname"),A=document.querySelector(".profile__avatar");function P(n){var o=_.querySelector(".element").cloneNode(!0),r=o.querySelector(".element__image"),c=n.name,a=n.link,u=n._id,i=n.owner._id,s=n.likes;o.querySelector(".element__title").textContent=c,r.src=a,r.alt=c;var l=o.querySelector(".element__like-count");return l.textContent=s.length,s.some((function(e){return e._id===w}))&&o.querySelector(".element__like").classList.add("element__like_active"),o.querySelector(".element__like").addEventListener("click",(function(t){t.target.classList.toggle("element__like_active"),t.target.classList.contains("element__like_active")?function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(u).then((function(e){l.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(u).then((function(e){l.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),w===i&&(o.querySelector(".element__delete").classList.add("element__delete_visible"),o.querySelector(".element__delete").addEventListener("click",(function(){return function(t,n){(function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(t).then((function(){n.remove()})).catch((function(e){console.log(e)}))}(u,o)}))),r.addEventListener("click",(function(){t(m),p.src=a,p.alt=c,f.textContent=c})),o}function U(e){d.prepend(e)}var w=1;function T(e,t){t.textContent=e?"Сохранение...":"Сохранить"}var D,B=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))};u.addEventListener("click",(function(){t(c),h.setAttribute("disabled",!0),h.classList.add("popup__submit-button_inactive")})),i.addEventListener("click",(function(){t(r),q.value=x.textContent,k.value=j.textContent,E.removeAttribute("disabled"),E.classList.remove("popup__submit-button_inactive")})),s.addEventListener("click",(function(){t(a),C.setAttribute("disabled",!0),C.classList.add("popup__submit-button_inactive")})),l.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup_opened")&&n(e),t.target.classList.contains("popup__close-button")&&n(e)}))})),v.addEventListener("submit",(function(t){var o;T(!0,h),(o={name:y.value,link:b.value},fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:o.name,link:o.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){U(P(e))})).catch((function(e){console.log(e)})).finally((function(){T(!1,h)})),t.preventDefault(),n(c),v.reset()})),g.addEventListener("submit",(function(t){var o;T(!0,C),(o=S.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).finally((function(){T(!1,C)})),A.src=S.value,t.preventDefault(),n(a)})),L.addEventListener("submit",(function(t){var o;T(!0,E),(o={name:q.value,about:k.value},fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o.name,about:o.about,avatar:o.avatar})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).finally((function(){T(!1,E)})),x.textContent=q.value,j.textContent=k.value,t.preventDefault(),n(r)})),D={formSelector:".popup__form",inputSelector:".popup__form-text",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__form-text_type_error",errorClass:"error_active"},Array.from(document.querySelectorAll(D.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);B(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),B(n,o,t)}))}))}(e,D)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){!function(e){for(var t=0;t<e.length;t++)U(P(e[t]))}(e)})).catch((function(e){console.log(e)})),fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){!function(e){w=e._id,x.textContent=e.name,j.textContent=e.about,A.src=e.avatar,n(r)}(e)})).catch((function(e){console.log(e)}))})();